<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ—è—Ç –¥–æ–º ‚Äì –ü–æ—Å–ª–µ–¥–Ω–∏ –æ–±—è–≤–∏ | JobPortal</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/user-home.css}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
          rel="stylesheet">
</head>
<body class="user-home-page">
<header class="user-hero">
    <div class="user-hero-bg">
        <div class="bg-glow glow-1"></div>
        <div class="bg-glow glow-2"></div>
        <div class="mesh-overlay"></div>
    </div>
    <div class="container">
        <div class="user-hero-content">
            <div class="user-identity">
                <!--                <div class="avatar" th:if="${user != null && user.avatar}">-->
                <!--                    <img th:src="${user.avatar}" alt="Avatar">-->
                <!--                </div>-->
                <!--                <div class="avatar placeholder" th:if="${user == null || user.avatar == null}">-->
                <!--                    <span th:text="${user != null ? user.fullName.substring(0,1) : 'U'}">U</span>-->
                <!--                </div>-->
                <div class="hello">
                    <p class="greeting">–ó–¥—Ä–∞–≤–µ–π,</p>
                    <h1 class="username" th:text="${user.username}">–ö–∞–Ω–¥–∏–¥–∞—Ç</h1>
                </div>
            </div>
            <div class="quick-stats" th:if="${userStats}">
                <div class="qstat">
                    <div class="qstat-value" th:text="${userStats.savedJobs}">0</div>
                    <div class="qstat-label">–ó–∞–ø–∞–∑–µ–Ω–∏</div>
                </div>
                <div class="qstat">
                    <div class="qstat-value" th:text="${userStats.applied}">0</div>
                    <div class="qstat-label">–ö–∞–Ω–¥–∏–¥–∞—Ç—É—Ä–∏</div>
                </div>
                <div class="qstat">
                    <div class="qstat-value" th:text="${userStats.matches}">0</div>
                    <div class="qstat-label">–°—ä–≤–ø–∞–¥–µ–Ω–∏—è</div>
                </div>
            </div>
            <div class="profile-menu-wrapper" th:if="${user != null}">
                <button type="button"
                        class="profile-trigger"
                        id="profileTrigger"
                        aria-haspopup="true"
                        aria-expanded="false">
                    <span class="sr-only">–ü—Ä–æ—Ñ–∏–ª</span>
                    <span th:if="${user.avatar != null}">
                        <img th:src="${user.avatar}" alt="–ü—Ä–æ—Ñ–∏–ª">
                    </span>
                    <span class="avatar-fallback" th:if="${user.avatar == null}"
                          th:text="${user.username}">U</span>
                    <span class="trigger-name">
                        <span>–ü—Ä–æ—Ñ–∏–ª</span>
                        <span th:text="${user.username}">–ö–∞–Ω–¥–∏–¥–∞—Ç</span>
                    </span>
                    <svg class="trigger-caret" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                         aria-hidden="true">
                        <path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2"
                              stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                </button>
                <div class="profile-dropdown" id="profileDropdown" role="menu" aria-labelledby="profileTrigger">
                    <div class="profile-header">
                        <div class="ph-avatar">
                            <img th:if="${user.avatar != null}" th:src="${user.avatar}" alt="–ê–≤–∞—Ç–∞—Ä">
                            <span th:if="${user.avatar == null}"
                                  th:text="${user.username != null ? user.username.substring(0,1) : 'U'}">U</span>
                        </div>
                        <!--                        <div class="ph-info">-->
                        <!--                            <div class="ph-name" th:text="${user.fullName}">–ö–∞–Ω–¥–∏–¥–∞—Ç</div>-->
                        <!--                            <div class="ph-email" th:text="${user.email}">user@mail.com</div>-->
                        <!--                        </div>-->
                    </div>

                    <a class="profile-item" th:href="@{/recruiter/jobs/new}" th:if="${user.role == T(app.model.UserRole).RECRUITER}" role="menuitem">
                        <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M20 7h-4V6a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v1H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2Zm-10-1h4v1h-4V6Z"/>
                        </svg>
                        <span>Create Job</span>
                    </a>
                    <a class="profile-item" th:href="@{/recruiter-applications}" th:if="${user.role == T(app.model.UserRole).RECRUITER}" role="menuitem">
                        <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M20 7h-4V6a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v1H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2Zm-10-1h4v1h-4V6Z"/>
                        </svg>
                        <span>Applications</span>
                    </a>
                    <a class="profile-item" th:href="@{/profile/jobs}" role="menuitem">
                        <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M20 7h-4V6a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v1H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2Zm-10-1h4v1h-4V6Z"/>
                        </svg>
                        <span>My Jobs</span>
                    </a>
                    <a class="profile-item" th:href="@{/account}" role="menuitem">
                        <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm7 9a7 7 0 0 0-14 0"/>
                        </svg>
                        <span>View Account</span>
                    </a>
                    <a class="profile-item" th:href="@{/account(tab='tab-security')}" role="menuitem">
                        <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10Z" fill="none" stroke="currentColor"
                                  stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>–°–∏–≥—É—Ä–Ω–æ—Å—Ç</span>
                    </a>
                    <a class="profile-item" th:href="@{/account(tab='tab-preferences')}" role="menuitem">
                        <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M12 6v12M6 12h12" fill="none" stroke="currentColor" stroke-width="2"
                                  stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–Ω–∏—è</span>
                    </a>
                    <form th:action="@{/logout}" method="post" class="profile-item as-form" role="none">
                        <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}">
                        <button type="submit">
                            <svg viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/>
                            </svg>
                            <span>Sign Out</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <form class="user-search" th:action="@{/jobs/search}" method="get">
            <div class="search-card">
                <div class="search-header">
                    <div class="search-intro">
                        <span class="search-badge">–ò–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–Ω–æ —Ç—ä—Ä—Å–µ–Ω–µ</span>
                        <h2 class="search-title">–ù–∞–º–µ—Ä–∏ —Å–ª–µ–¥–≤–∞—â–∞—Ç–∞ —Å–∏ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç</h2>
                        <p class="search-subtitle">–§–∏–ª—Ç—Ä–∏—Ä–∞–π –æ–±—è–≤–∏—Ç–µ –ø–æ –∫–ª—é—á–æ–≤–∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –∏ –ø–æ–ª—É—á–∏ –Ω–∞–π-–ø–æ–¥—Ö–æ–¥—è—â–∏—Ç–µ
                            —Ä–µ–∑—É–ª—Ç–∞—Ç–∏.</p>
                    </div>
                    <div class="search-actions">
                        <button type="reset" class="search-reset">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 12a9 9 0 1 0 9-9"/>
                                <path d="M3 3v6h6"/>
                            </svg>
                            <span>–ò–∑—á–∏—Å—Ç–∏</span>
                        </button>
                        <button type="button" class="search-advanced-toggle" data-target="advancedFilters"
                                aria-expanded="false">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 5h18"/>
                                <path d="M7 10h10"/>
                                <path d="M11 15h2"/>
                                <path d="M13 20L19 12"/>
                                <path d="M11 20L5 12"/>
                            </svg>
                            <span>–†–∞–∑—à–∏—Ä–µ–Ω–∏ —Ñ–∏–ª—Ç—Ä–∏</span>
                        </button>
                    </div>
                </div>

                <div class="search-grid">
                    <label class="field">
                        <span class="field-label">–ü–æ–∑–∏—Ü–∏—è / –∫–ª—é—á–æ–≤–∞ –¥—É–º–∞</span>
                        <div class="field-control">
                            <svg class="field-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                 viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 21l-4.35-4.35"/>
                                <circle cx="11" cy="11" r="7"/>
                            </svg>
                            <input type="text" name="keyword" placeholder="–ü—Ä–∏–º–µ—Ä: Java Developer"
                                   aria-label="–ö–ª—é—á–æ–≤–∞ –¥—É–º–∞">
                        </div>
                    </label>

                    <label class="field">
                        <span class="field-label">–õ–æ–∫–∞—Ü–∏—è</span>
                        <div class="field-control">
                            <svg class="field-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                 viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10a9 9 0 1 0-18 0c0 5 9 12 9 12s9-7 9-12z"/>
                                <circle cx="12" cy="10" r="3"/>
                            </svg>
                            <input type="text" name="location" placeholder="–°–æ—Ñ–∏—è, –¥–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω–æ..."
                                   aria-label="–õ–æ–∫–∞—Ü–∏—è">
                        </div>
                    </label>

                    <label class="field">
                        <span class="field-label">–¢–∏–ø –∑–∞–µ—Ç–æ—Å—Ç</span>
                        <div class="field-control">
                            <svg class="field-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                 viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 7h18"/>
                                <path d="M5 7v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7"/>
                                <path d="M9 7V5a3 3 0 0 1 6 0v2"/>
                            </svg>
                            <select name="jobType" aria-label="–¢–∏–ø">
                                <option value="">–í—Å–∏—á–∫–∏ —Ç–∏–ø–æ–≤–µ</option>
                                <option value="FULL_TIME">–ü—ä–ª–µ–Ω –¥–µ–Ω</option>
                                <option value="PART_TIME">–ù–µ–ø—ä–ª–µ–Ω –¥–µ–Ω</option>
                                <option value="CONTRACT">–î–æ–≥–æ–≤–æ—Ä</option>
                                <option value="REMOTE">–î–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω–æ</option>
                            </select>
                        </div>
                    </label>

                    <div class="field submit-field">
                        <button class="btn-search" type="submit">
                            <span>–¢—ä—Ä—Å–∏</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                 fill="none"
                                 stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="advanced-filters" id="advancedFilters">
                    <div class="advanced-grid">
                        <label class="field">
                            <span class="field-label">–ù–∏–≤–æ –æ–ø–∏—Ç</span>
                            <div class="field-control">
                                <svg class="field-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                     viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M7 20h10"/>
                                    <path d="M12 14v6"/>
                                    <path d="M9 11l3-3 3 3"/>
                                    <path d="M12 4v4"/>
                                </svg>
                                <select name="experienceLevel" aria-label="–ù–∏–≤–æ –æ–ø–∏—Ç">
                                    <option value="">–í—Å–∏—á–∫–∏ –Ω–∏–≤–∞</option>
                                    <option value="INTERN">–°—Ç–∞–∂–∞–Ω—Ç</option>
                                    <option value="JUNIOR">Junior</option>
                                    <option value="MID">Mid</option>
                                    <option value="SENIOR">Senior</option>
                                    <option value="LEAD">Lead</option>
                                </select>
                            </div>
                        </label>

                        <div class="field range-field">
                            <span class="field-label">–ú–µ—Å–µ—á–Ω–∞ –∑–∞–ø–ª–∞—Ç–∞ (–ª–≤.)</span>
                            <div class="range-controls">
                                <div class="field-control">
                                    <span class="range-prefix">–æ—Ç</span>
                                    <input type="number" name="salaryMin" min="0" step="100" placeholder="2000">
                                </div>
                                <div class="field-control">
                                    <span class="range-prefix">–¥–æ</span>
                                    <input type="number" name="salaryMax" min="0" step="100" placeholder="6000">
                                </div>
                            </div>
                        </div>

                        <label class="field">
                            <span class="field-label">–ü—É–±–ª–∏–∫—É–≤–∞–Ω–∞</span>
                            <div class="field-control">
                                <svg class="field-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                     viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="9"/>
                                    <path d="M12 7v5l3 3"/>
                                </svg>
                                <select name="postedWithin" aria-label="–ü–µ—Ä–∏–æ–¥">
                                    <option value="">–ë–µ–∑ –∑–Ω–∞—á–µ–Ω–∏–µ</option>
                                    <option value="1">–ü–æ—Å–ª–µ–¥–Ω–∏—Ç–µ 24 —á–∞—Å–∞</option>
                                    <option value="3">–ü–æ—Å–ª–µ–¥–Ω–∏—Ç–µ 3 –¥–Ω–∏</option>
                                    <option value="7">–ü–æ—Å–ª–µ–¥–Ω–∞—Ç–∞ —Å–µ–¥–º–∏—Ü–∞</option>
                                    <option value="14">–ü–æ—Å–ª–µ–¥–Ω–∏—Ç–µ 2 —Å–µ–¥–º–∏—Ü–∏</option>
                                    <option value="30">–ü–æ—Å–ª–µ–¥–Ω–∏—è –º–µ—Å–µ—Ü</option>
                                </select>
                            </div>
                        </label>

                        <div class="field toggle-field">
                            <span class="field-label">–†–∞–±–æ—Ç–∞</span>
                            <label class="switch">
                                <input type="checkbox" name="remoteOnly" value="true">
                                <span class="switch-slider"></span>
                                <span class="switch-label">–°–∞–º–æ –¥–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω–∏ –ø–æ–∑–∏—Ü–∏–∏</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="chips highlighted" th:if="${suggestedTags}">
                    <span class="chips-title">–ü–æ–ø—É–ª—è—Ä–Ω–∏ —Ç—ä—Ä—Å–µ–Ω–∏—è:</span>
                    <a class="chip" th:each="t : ${suggestedTags}" th:text="${t}"
                       th:href="@{/jobs/search(keyword=${t})}">Java</a>
                </div>
            </div>
        </form>
    </div>
</header>

<main class="user-home-main">
    <div class="container">
        <div class="section-head">
            <div>
                <span class="badge">–ù–æ–≤–æ</span>
                <h2>–ü–æ—Å–ª–µ–¥–Ω–æ –¥–æ–±–∞–≤–µ–Ω–∏ –æ–±—è–≤–∏</h2>
                <p class="sub">–ê–∫—Ç—É–∞–ª–Ω–∏ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –ø–æ–¥—Ä–µ–¥–µ–Ω–∏ –ø–æ –¥–∞—Ç–∞ –Ω–∞ –ø—É–±–ª–∏–∫—É–≤–∞–Ω–µ</p>
            </div>
            <a th:href="@{/jobs}" class="view-all">–í–∏–∂ –≤—Å–∏—á–∫–∏ ‚Üí</a>
        </div>

        <div class="feed-grid">
            <article class="job-tile" th:each="job : ${latestJobs}">
                <div class="tile-head">
                    <div class="brand">
                        <!--                        <div class="brand-logo" th:if="${job.company.logo}">-->
                        <!--                            <img th:src="${job.company.logo}" alt="Logo">-->
                        <!--                        </div>-->
                        <div class="brand-logo placeholder" th:if="${job.company == null}">
                            <span th:text="${job.company.substring(0,1)}">C</span>
                        </div>
                        <div class="brand-text">
                            <h3 class="job-title"><a th:href="@{/jobs/{id}(id=${job.id})}" th:text="${job.title}">Job
                                title</a></h3>
                            <p class="company" th:text="${job.company}">Company</p>
                        </div>
                    </div>
                    <button class="save" title="–ó–∞–ø–∞–∑–∏">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                             stroke="currentColor" stroke-width="2">
                            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                        </svg>
                    </button>
                </div>
                <div class="tile-meta">
            <span class="meta">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                   stroke="currentColor" stroke-width="2"><path
                      d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
              <span th:text="${job.location}">–°–æ—Ñ–∏—è</span>
            </span>
                    <span class="meta type" th:text="${job.employmentType}">Full-time</span>
                    <span class="meta posted">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                   stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline
                      points="12 6 12 12 16 14"></polyline></svg>
              <span th:text="${job.postedOn}">–ü—Ä–µ–¥–∏ 2 –¥–Ω–∏</span>
            </span>
                </div>
                <p class="tile-desc" th:text="${job.description}">–ö—Ä–∞—Ç–∫–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –ø–æ–∑–∏—Ü–∏—è—Ç–∞...</p>
                <!--                <div class="tile-tags" th:if="${job.tags}">-->
                <!--                    <span class="tag" th:each="tag : ${job.tags}" th:text="${tag}">Java</span>-->
                <!--                </div>-->
                <div class="tile-foot">
                    <div class="salary" th:text="${job.salaryMax}">5 000 - 7 000 –ª–≤.</div>

                    <a th:href="@{/jobs/{id}(id=${job.id})}" class="btn-outline">–î–µ—Ç–∞–π–ª–∏</a>

                    <form th:action="@{'/jobs/' + ${job.id}}" method="post" class="quest-action-form">
                        <input type="hidden" name="_method" value="PATCH"/>
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <button th:if="${job.appliedUser == null}" class="gold-regular-button completed">–ö–∞–Ω–¥–∏–¥–∞—Ç—Å—Ç–≤–∞–π
                        </button>
                        <x></x>
                        <button th:unless="${job.appliedUser == null}" class="gold-regular-button completed">–ó–∞—è–≤–µ–Ω–æ
                        </button>
                    </form>
                </div>
            </article>
        </div>

        <div class="empty" th:if="${latestJobs == null || #lists.isEmpty(latestJobs)}">
            <div class="empty-card">
                <div class="empty-icon">üîé</div>
                <h3>–ù—è–º–∞ –Ω–æ–≤–∏ –æ–±—è–≤–∏</h3>
                <p>–ê–±–æ–Ω–∏—Ä–∞–π —Å–µ –∑–∞ –∏–∑–≤–µ—Å—Ç–∏—è –∏–ª–∏ –ø—Ä–µ–≥–ª–µ–¥–∞–π –≤—Å–∏—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.</p>
                <div class="empty-actions">
                    <a th:href="@{/jobs}" class="btn-secondary">–†–∞–∑–≥–ª–µ–¥–∞–π –≤—Å–∏—á–∫–∏</a>
                    <a th:href="@{/alerts}" class="btn-primary">–ê–∫—Ç–∏–≤–∏—Ä–∞–π –∏–∑–≤–µ—Å—Ç–∏—è</a>
                </div>
            </div>
        </div>

        <div class="section-head mt">
            <div>
                <span class="badge alt">–ü—Ä–µ–ø–æ—Ä—ä—á–∞–Ω–æ –∑–∞ —Ç–µ–±</span>
                <h2>–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å–ø–æ—Ä–µ–¥ –ø—Ä–æ—Ñ–∏–ª–∞</h2>
                <p class="sub">–ë–∞–∑–∏—Ä–∞–Ω–∏ –Ω–∞ —Ç–≤–æ–∏—Ç–µ —É–º–µ–Ω–∏—è –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç</p>
            </div>
        </div>
        <div class="recommendations" th:if="${recommendedJobs}">
            <a class="pill" th:each="r : ${recommendedJobs}" th:href="@{/jobs/{id}(id=${r.id})}">
                <span class="pill-title" th:text="${r.title}">Backend Engineer</span>
                <span class="pill-sub" th:text="${r.company.name}">Acme</span>
            </a>
        </div>
    </div>
</main>
<script>
    (() => {
      const KEY_PREFIX = 'jp:apply:';
      const forms = document.querySelectorAll('.quest-action-form');

      const normalizeId = (form, index) => {
        if (form.dataset.jobId) return form.dataset.jobId;
        const fallback = form.getAttribute('action') || `virtual-${index}`;
        const hash = fallback.replace(/[^a-zA-Z0-9]/g, '');
        const id = hash || `virtual-${index}`;
        form.dataset.jobId = id;
        return id;
      };

      const setState = (button, state) => {
        if (!button) return;
        if (state === 'applied') {
          button.textContent = '–ó–∞—è–≤–µ–Ω–æ';
          button.classList.add('completed');
          button.title = '–î–≤–æ–π–Ω–æ –∫–ª–∏–∫–≤–∞–Ω–µ –∑–∞ –æ—Ç–º—è–Ω–∞';
        } else {
          button.textContent = '–ö–∞–Ω–¥–∏–¥–∞—Ç—Å—Ç–≤–∞–π';
          button.classList.remove('completed');
          button.title = '';
        }
      };

      forms.forEach((form, index) => {
        const button = form.querySelector('button');
        if (!button) return;
        const jobId = normalizeId(form, index);
        const storageKey = `${KEY_PREFIX}${jobId}`;

        // –ø—ä—Ä–≤–æ–Ω–∞—á–∞–ª–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ
        if (localStorage.getItem(storageKey) === '1') {
          setState(button, 'applied');
        }

        // —Å–∏–º—É–ª–∏—Ä–∞–º–µ –∏–∑–ø—Ä–∞—â–∞–Ω–µ
        form.addEventListener('submit', (event) => {
          localStorage.setItem(storageKey, '1');
          setState(button, 'applied');
        });

        // –¥–≤–æ–π–Ω–æ –∫–ª–∏–∫–≤–∞–Ω–µ –∑–∞ –æ—Ç–º—è–Ω–∞
        button.addEventListener('dblclick', (event) => {
          event.preventDefault();
          localStorage.removeItem(storageKey);
          setState(button, 'idle');
        });
      });
    })();
</script>
<script>
    const profileTrigger = document.getElementById('profileTrigger');
    const profileDropdown = document.getElementById('profileDropdown');
    if (profileTrigger && profileDropdown) {
      const setMenuState = (isOpen) => {
        profileDropdown.classList.toggle('is-open', isOpen);
        profileTrigger.setAttribute('aria-expanded', String(isOpen));
      };

      profileTrigger.addEventListener('click', (event) => {
        event.stopPropagation();
        const shouldOpen = !profileDropdown.classList.contains('is-open');
        setMenuState(shouldOpen);
      });

      profileDropdown.addEventListener('click', (event) => {
        event.stopPropagation();
      });

      document.addEventListener('click', () => {
        if (profileDropdown.classList.contains('is-open')) {
          setMenuState(false);
        }
      });

      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && profileDropdown.classList.contains('is-open')) {
          setMenuState(false);
          profileTrigger.focus();
        }
      });
    }

    // Advanced filter toggle
var advancedToggle = document.querySelector('.search-advanced-toggle');
if (advancedToggle) {
  var targetId = advancedToggle.dataset.target;
  var targetEl = document.getElementById(targetId);

  if (targetEl) {
    advancedToggle.addEventListener('click', function() {
      var isOpen = targetEl.classList.toggle('is-open');
      advancedToggle.setAttribute('aria-expanded', String(isOpen));
    });

    var formEl = advancedToggle.closest('form');
    if (formEl) {
      formEl.addEventListener('reset', function() {
        if (targetEl.classList.contains('is-open')) {
          targetEl.classList.remove('is-open');
          advancedToggle.setAttribute('aria-expanded', 'false');
        }
      });
    }
  }
}

// Search form submission
var searchForm = document.querySelector('.user-search');
if (searchForm) {
  searchForm.addEventListener('submit', function(event) {
    event.preventDefault();

    var keywordInput = searchForm.querySelector('input[name="keyword"]');
    var locationInput = searchForm.querySelector('input[name="location"]');
    var jobTypeSelect = searchForm.querySelector('select[name="jobType"]');

    var keyword = keywordInput ? keywordInput.value : '';
    var location = locationInput ? locationInput.value : '';
    var jobType = jobTypeSelect ? jobTypeSelect.value : '';

    // Build URL with query parameters
    var params = new URLSearchParams();
    if (keyword) params.append('keyword', keyword);
    if (location) params.append('location', location);
    if (jobType) params.append('jobType', jobType);

    var url = '/jobs/search';
    if (params.toString()) {
      url += '?' + params.toString();
    }

    window.location.href = url;
  });
}

    // Small reveal animation on scroll
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          e.target.classList.add('reveal');
          io.unobserve(e.target);
        }
      });
    }, {threshold: 0.15});
    document.querySelectorAll('.job-tile, .empty-card, .pill').forEach(el=>io.observe(el));
</script>
</body>
</html>