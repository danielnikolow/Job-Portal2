<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Създаване на обява | JobPortal</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/recruiter-create-job.css}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body class="create-job-page" th:attr="data-username=${user != null ? user.username : ''}">
<header class="create-hero">
    <div class="container">
        <div class="create-hero-heading">
            <span class="eyebrow">Recruiter Studio</span>
            <h1>Създай впечатляваща обява, която привлича най-добрите таланти</h1>
            <p>Персонализирай всяка част от офертата си – от ключови изисквания до предимства и условия на работа.
                В реално време виждаш как кандидатите ще я виждат.</p>
        </div>
        <div class="create-hero-insights">
            <div class="insight-card">
                <span class="insight-value">+68%</span>
                <span class="insight-label">Повече кандидатури при детайлни описания</span>
            </div>
            <div class="insight-card">
                <span class="insight-value">4:32 мин</span>
                <span class="insight-label">Средно време за попълване</span>
            </div>
            <div class="insight-card">
                <span class="insight-value">12K+</span>
                <span class="insight-label">Активни професионалисти в платформата</span>
            </div>
        </div>
    </div>
</header>

<main class="create-main">
    <div class="container create-layout">
        <aside class="preview-panel" aria-label="Преглед на обявата">
            <div class="preview-card">
                <div class="preview-header">
                    <span class="preview-status">
                        <svg viewBox="0 0 20 20" aria-hidden="true">
                            <path d="M7 12.5 4.5 10 3 11.5 7 15.5 17 5.5 15.5 4z" />
                        </svg>
                        <span>Чернова</span>
                    </span>
                    <span class="preview-title" id="previewTitle">Senior Product Designer</span>
                    <span class="preview-company" id="previewCompany">Visionary Labs · София / Хибрид</span>
                </div>
                <div class="preview-tags" id="previewTags">
                    <span class="preview-tag">Пълен ден</span>
                    <span class="preview-tag">UX / UI</span>
                    <span class="preview-tag">Екип: Product</span>
                </div>
                <p class="preview-description" id="previewSummary">Търсим дизайнер с афинитет към сложни системи, който да води продуктови инициативи и да работи тясно с инженерен екип.</p>
                <div class="preview-meta">
                    <div class="preview-meta-row">
                        <span>Диапазон</span>
                        <strong id="previewSalary">6 000 - 8 000 лв. · Нетно</strong>
                    </div>
                    <div class="preview-meta-row">
                        <span>Опит</span>
                        <strong id="previewExperience">5+ години</strong>
                    </div>
                </div>
                <div class="preview-footer">
                    <span class="preview-pill" id="previewDeadline">Крайна дата: 30.12.2025</span>
                    <span class="preview-pill" id="previewWorkModel">Работен модел: Хибрид</span>
                </div>
                <div class="preview-timeline">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                    Последна редакция преди <span id="previewUpdated">0 минути</span>
                </div>
            </div>
            <div class="preview-metrics">
                <div class="preview-metric">
                    <strong id="previewMatch">82%</strong>
                    <span>Очаквано съвпадение</span>
                </div>
                <div class="preview-metric">
                    <strong id="previewImpact">+24%</strong>
                    <span>Видимост при премиум</span>
                </div>
            </div>
        </aside>

        <section class="form-panel">
            <div class="form-headline">
                <div>
                    <h2>Детайли за обявата</h2>
                    <p>Започни със силно заглавие, точни изисквания и ясно послание. Секцията за предпреглед ще ти показва резултатите в реално време.</p>
                </div>
                <div th:if="${jobDraftSaved}">
                    <div class="form-flash">Черновата е запазена успешно.</div>
                </div>
            </div>
            <div class="section-divider"></div>
            <form class="create-form" th:action="@{/recruiter/jobs}" method="post" id="createJobForm" th:object="${createJobRequest}">
                <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}">
                <input type="hidden" th:field="*{requirements}" id="requirementsField">
                <input type="hidden" th:field="*{benefits}" id="benefitsField">

                <div class="form-section" id="section-basics">
                    <div class="section-title">
                        <span class="section-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 21h8"/><path d="M12 17v4"/><path d="m7 9 5-6 5 6"/><path d="M4 9h16"/><path d="M3 13h18"/><path d="M4 17h16"/></svg>
                        </span>
                        <div>
                            <h3>Основна информация</h3>
                            <p class="section-subtitle">Опиши позицията, екипа и мястото на работа.</p>
                        </div>
                    </div>
                    <div class="fields-grid">
                        <label class="field span-8">
                            <span class="field-label">Заглавие на позицията</span>
                            <div class="field-control">
                                <input type="text" th:field="*{title}" placeholder="Пример: Senior Product Designer" maxlength="80" required>
                                <!--                                <span class="field-hint">Мисли за ключови думи, които кандидатите търсят.</span>-->
                            </div>
                        </label>
                        <label class="field span-4">
                            <span class="field-label">Екип / отдел</span>
                            <div class="field-control">
                                <input type="text" th:field="*{team}" placeholder="Пример: Product Design">
                            </div>
                        </label>
                        <label class="field span-4">
                            <span class="field-label">Компания</span>
                            <div class="field-control">
                                <input type="text" th:field="*{company}" placeholder="Име на компанията" required>
                            </div>
                        </label>
                        <label class="field span-4">
                            <span class="field-label">Локация</span>
                            <div class="field-control">
                                <input type="text" th:field="*{location}" placeholder="София, Пловдив, Remote" required>
                            </div>
                        </label>
                        <label class="field span-4">
                            <span class="field-label">Тип заетост</span>
                            <div class="field-control">
                                <select th:field="*{employmentType}" required>
                                    <option th:value="FULL_TIME">Пълен ден</option>
                                    <option th:value="PART_TIME">Непълен ден</option>
                                    <option th:value="CONTRACT">Договор</option>
                                    <option th:value="INTERN">Стаж</option>
                                </select>
                            </div>
                        </label>
                    </div>
                    <div class="segment">
                        <span class="field-label">Работен модел</span>
                        <div class="inline-options" id="workModelOptions">
                            <label class="option-chip" data-value="ON_SITE">На място<input type="radio" th:field="*{workModel}" value="ON_SITE"></label>
                            <label class="option-chip" data-value="HYBRID">Хибрид<input type="radio" th:field="*{workModel}" value="HYBRID"></label>
                            <label class="option-chip" data-value="REMOTE">Отдалечено<input type="radio" th:field="*{workModel}" value="REMOTE"></label>
                        </div>
                    </div>
                </div>

                <div class="form-section" id="section-compensation">
                    <div class="section-title">
                        <span class="section-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 8c-1.7 0-3 .9-3 2s1.3 2 3 2 3 .9 3 2-1.3 2-3 2"/><path d="M12 4v1"/><path d="M12 19v1"/></svg>
                        </span>
                        <div>
                            <h3>Възнаграждение</h3>
                            <p class="section-subtitle">Дай прозрачност за диапазона, валутата и периодичността.</p>
                        </div>
                    </div>
                    <div class="fields-grid">
                        <label class="field span-4">
                            <span class="field-label">Минимална заплата</span>
                            <div class="field-control">
                                <input type="number" th:field="*{salaryMin}" placeholder="5500" min="0" step="100">
                            </div>
                        </label>
                        <label class="field span-4">
                            <span class="field-label">Максимална заплата</span>
                            <div class="field-control">
                                <input type="number" th:field="*{salaryMax}" placeholder="7500" min="0" step="100">
                            </div>
                        </label>
                        <label class="field span-2">
                            <span class="field-label">Валута</span>
                            <div class="field-control">
                                <select th:field="*{currency}">
                                    <option th:value="BGN">BGN</option>
                                    <option th:value="EUR">EUR</option>
                                    <option th:value="USD">USD</option>
                                </select>
                            </div>
                        </label>
                        <label class="field span-2">
                            <span class="field-label">Период</span>
                            <div class="field-control">
                                <select th:field="*{payCycle}">
                                    <option th:value="monthly">Месечно</option>
                                    <option th:value="yearly">Годишно</option>
                                    <option th:value="weekly">Седмично</option>
                                </select>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="form-section" id="section-description">
                    <div class="section-title">
                        <span class="section-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 0 6.5 17H20"/><path d="M6.5 17 4 19.5V4a2 2 0 0 1 2-2h10"/><path d="M8 8h8"/><path d="M8 12h6"/><path d="m16 3 5 5"/><path d="M21 8H16V3"/></svg>
                        </span>
                        <div>
                            <h3>Описание и мисия</h3>
                            <p class="section-subtitle">Разкажи защо ролята е важна, над какво ще работи човекът и какво ще постигнете.</p>
                        </div>
                    </div>
                    <div class="fields-grid">
                        <label class="field span-12">
                            <span class="field-label">Кратък акцент</span>
                            <div class="field-control">
                                <textarea th:field="*{summary}" rows="3" maxlength="240" placeholder="В две-три изречения опиши защо ролята е вълнуваща." required></textarea>
                                <span class="char-count" data-field="summary">0 / 240</span>
                            </div>
                        </label>
                        <label class="field span-12">
                            <span class="field-label">Пълно описание</span>
                            <div class="field-control">
                                <textarea th:field="*{description}" maxlength="1800" placeholder="Опиши ключовите отговорности, с кого ще се работи, какви технологии използвате и какъв е процесът." required></textarea>
                                <span class="char-count" data-field="description">0 / 1800</span>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="section-divider"></div>

                <div class="form-section" id="section-requirements">
                    <div class="section-title">
                        <span class="section-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        </span>
                        <div>
                            <h3>Изисквания и умения</h3>
                            <p class="section-subtitle">Създай списък с най-важните критерии. Добавяй и премахвай лесно.</p>
                        </div>
                    </div>
                    <div class="add-requirement">
                        <div class="field-control">
                            <input type="text" id="requirementInput" placeholder="Например: Опит със Spring Boot или React">
                        </div>
                        <button type="button" id="addRequirement">Добави изискване</button>
                    </div>
                    <div class="requirements-chips" id="requirementsList"></div>
                </div>

                <div class="section-divider"></div>

                <div class="form-section" id="section-benefits">
                    <!--                    <div class="section-title">-->
                    <!--                        <span class="section-icon">-->
                    <!--                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>-->
                    <!--                        </span>-->
                    <!--                        <div>-->
                    <!--                            <h3>Предимства</h3>-->
                    <!--                            <p class="section-subtitle">Подчертай културата и пакетът от придобивки.</p>-->
                    <!--                        </div>-->
                    <!--                    </div>-->
                    <!--                    <div class="benefits-grid" id="benefitsGrid">-->
                    <!--                        <label class="benefit-card" data-value="wellness">-->
                    <!--                            <input type="checkbox" value="Програма за здраве и благополучие">-->
                    <!--                            <span class="benefit-title">Уелнес бюджет</span>-->
                    <!--                            <span class="benefit-desc">Годишен бюджет за спорт, психотерапевт и превенция.</span>-->
                    <!--                        </label>-->
                    <!--                        <label class="benefit-card" data-value="learning">-->
                    <!--                            <input type="checkbox" value="Бюджет за обучения и конференции">-->
                    <!--                            <span class="benefit-title">Обучение</span>-->
                    <!--                            <span class="benefit-desc">1 500 лв. годишно за обучения и конференции.</span>-->
                    <!--                        </label>-->
                    <!--                        <label class="benefit-card" data-value="remote-kit">-->
                    <!--                            <input type="checkbox" value="Пълен remote setup и коуъркинг бюджет">-->
                    <!--                            <span class="benefit-title">Remote комплект</span>-->
                    <!--                            <span class="benefit-desc">Оборудване и бюджет за коуъркинг пространство.</span>-->
                    <!--                        </label>-->
                    <!--                        <label class="benefit-card" data-value="equity">-->
                    <!--                            <input type="checkbox" value="Възможност за дялово участие">-->
                    <!--                            <span class="benefit-title">Equity програма</span>-->
                    <!--                            <span class="benefit-desc">Опция за участие в успеха на компанията.</span>-->
                    <!--                        </label>-->
                    <!--                    </div>-->
                </div>

                <div class="form-section" id="section-settings">
                    <div class="section-title">
                        <span class="section-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9"/><polyline points="3 3 3 9 9 9"/></svg>
                        </span>
                        <div>
                            <h3>Публикуване</h3>
                            <p class="section-subtitle">Контролирай видимостта и срока на обявата.</p>
                        </div>
                    </div>
                    <div class="timeline-grid">
                        <label class="field">
                            <span class="field-label">Дата на публикуване</span>
                            <div class="field-control">
                                <input type="date" th:field="*{publishDate}">
                            </div>
                        </label>
                        <label class="field">
                            <span class="field-label">Крайна дата</span>
                            <div class="field-control">
                                <input type="date" th:field="*{deadline}">
                            </div>
                        </label>
                    </div>

                </div>


                <div class="form-actions">
                    <button type="button" class="btn-secondary" id="btnPreview">Преглед</button>
                    <button type="submit" class="btn-primary">Запази и публикувай</button>
                </div>
            </form>
        </section>
    </div>
</main>

<script>
    (() => {
      const form = document.getElementById('createJobForm');
      if (!form) {
        return;
      }

      const preview = {
        title: document.getElementById('previewTitle'),
        company: document.getElementById('previewCompany'),
        summary: document.getElementById('previewSummary'),
        tags: document.getElementById('previewTags'),
        salary: document.getElementById('previewSalary'),
        experience: document.getElementById('previewExperience'),
        deadline: document.getElementById('previewDeadline'),
        workModel: document.getElementById('previewWorkModel'),
        updated: document.getElementById('previewUpdated')
      };

      const fields = {
        title: form.elements['title'],
        team: form.elements['team'],
        company: form.elements['company'],
        location: form.elements['location'],
        employmentType: form.elements['employmentType'],
        workModel: form.elements['workModel'],
        summary: form.elements['summary'],
        description: form.elements['description'],
        salaryMin: form.elements['salaryMin'],
        salaryMax: form.elements['salaryMax'],
        currency: form.elements['currency'],
        payCycle: form.elements['payCycle'],
        publishDate: form.elements['publishDate'],
        deadline: form.elements['deadline']
      };

      const updatePreview = () => {
        const title = fields.title?.value.trim() || 'Senior Product Designer';
        const company = fields.company?.value.trim() || 'Visionary Labs';
        const location = fields.location?.value.trim() || 'София / Хибрид';
        const team = fields.team?.value.trim() || 'Product';

        let employment = 'Пълен ден';
        if (fields.employmentType instanceof HTMLSelectElement) {
          employment = fields.employmentType.options[fields.employmentType.selectedIndex]?.text || employment;
        }

        preview.title.textContent = title;
        preview.company.textContent = `${company} · ${location}`;

        const tags = [employment, team ? `Екип: ${team}` : null].filter(Boolean);
        preview.tags.innerHTML = tags.map(tag => `<span class="preview-tag">${tag}</span>`).join('');

        const summary = fields.summary?.value.trim() || 'Опиши защо позицията е ключова, над какви продукти се работи и какъв профил търсиш.';
        preview.summary.textContent = summary;

        const salaryMin = fields.salaryMin?.value.trim();
        const salaryMax = fields.salaryMax?.value.trim();
        const currency = fields.currency?.value || 'BGN';
        let payCycle = 'месечно';
        if (fields.payCycle instanceof HTMLSelectElement) {
          payCycle = fields.payCycle.options[fields.payCycle.selectedIndex]?.text?.toLowerCase() || payCycle;
        }

        if (salaryMin || salaryMax) {
          const minFormatted = salaryMin ? `${Number(salaryMin).toLocaleString('bg-BG')} ${currency}` : '';
          const maxFormatted = salaryMax ? `${Number(salaryMax).toLocaleString('bg-BG')} ${currency}` : '';
          const display = salaryMin && salaryMax ? `${minFormatted} - ${maxFormatted}` : minFormatted || maxFormatted;
          preview.salary.textContent = `${display} · ${payCycle}`;
        } else {
          preview.salary.textContent = 'По договорка';
        }

        const deadline = fields.deadline?.value ? new Date(fields.deadline.value).toLocaleDateString('bg-BG') : '30.12.2025';
        preview.deadline.textContent = `Крайна дата: ${deadline}`;

        const updatedAgo = new Intl.RelativeTimeFormat('bg', { numeric: 'auto' });
        preview.updated.textContent = updatedAgo.format(0, 'minute');
      };

      Object.values(fields).forEach(input => {
        if (!input || input instanceof RadioNodeList) {
          return;
        }
        input.addEventListener('input', updatePreview);
        input.addEventListener('change', updatePreview);
      });

      updatePreview();

      const workModelOptions = document.getElementById('workModelOptions');
      if (workModelOptions) {
        const syncWorkModelChips = () => {
          const currentValue = fields.workModel?.value || 'ON_SITE';
          workModelOptions.querySelectorAll('.option-chip').forEach(el => {
            const isActive = el.dataset.value === currentValue;
            el.classList.toggle('active', isActive);
            const input = el.querySelector('input[type="radio"]');
            if (input) {
              input.checked = isActive;
            }
          });
          const text = {
            'ON_SITE': 'Работен модел: На място',
            'HYBRID': 'Работен модел: Хибрид',
            'REMOTE': 'Работен модел: Отдалечено'
          }[currentValue] || 'Работен модел: Хибрид';
          preview.workModel.textContent = text;
        };

        workModelOptions.addEventListener('click', (event) => {
          const chip = event.target.closest('.option-chip');
          if (!chip) {
            return;
          }
          const input = chip.querySelector('input[type="radio"]');
          if (input) {
            input.checked = true;
            fields.workModel.value = input.value;
            syncWorkModelChips();
            updatePreview();
          }
        });

        syncWorkModelChips();
      }

      const handleCharCount = (textarea, element) => {
        const max = Number(textarea.getAttribute('maxlength')) || 0;
        const value = textarea.value.length;
        element.textContent = `${value} / ${max}`;
      };

      document.querySelectorAll('.char-count').forEach(counter => {
        const fieldName = counter.dataset.field;
        const textarea = form.elements[fieldName];
        if (!textarea) {
          return;
        }
        const update = () => handleCharCount(textarea, counter);
        textarea.addEventListener('input', update);
        update();
      });

      const requirementsField = form.elements['requirements'];
      const requirementsList = document.getElementById('requirementsList');
      const requirementInput = document.getElementById('requirementInput');
      const addRequirementBtn = document.getElementById('addRequirement');
      const requirements = requirementsField?.value ? requirementsField.value.split('|').filter(Boolean) : [];

      const renderRequirements = () => {
        requirementsField.value = requirements.join('|');
        requirementsList.innerHTML = requirements.map((item, index) => `
          <span class="requirement-chip">${item}
            <button type="button" data-index="${index}" aria-label="Премахни">×</button>
          </span>
        `).join('');
      };

      renderRequirements();

      addRequirementBtn?.addEventListener('click', () => {
        const value = requirementInput.value.trim();
        if (!value) {
          return;
        }
        requirements.push(value);
        requirementInput.value = '';
        renderRequirements();
        updatePreview();
      });

      requirementsList?.addEventListener('click', (event) => {
        const button = event.target.closest('button[data-index]');
        if (!button) {
          return;
        }
        const index = Number(button.dataset.index);
        requirements.splice(index, 1);
        renderRequirements();
        updatePreview();
      });

      const benefitsField = form.elements['benefits'];
      const benefitsGrid = document.getElementById('benefitsGrid');

      const syncBenefits = () => {
        if (!benefitsGrid) {
          return;
        }
        const selected = Array.from(benefitsGrid.querySelectorAll('input[type="checkbox"]:checked'))
          .map(input => input.value.trim());
        benefitsField.value = selected.join('|');
        benefitsGrid.querySelectorAll('.benefit-card').forEach(card => {
          const checkbox = card.querySelector('input[type="checkbox"]');
          card.classList.toggle('active', checkbox.checked);
        });
      };

      benefitsGrid?.addEventListener('change', syncBenefits);
      syncBenefits();

      const btnPreview = document.getElementById('btnPreview');
      btnPreview?.addEventListener('click', () => {
        const summary = fields.summary?.value.trim() || '';
        const description = fields.description?.value.trim() || '';
        const previewMessage = `\nЗаглавие: ${fields.title?.value || 'Не е попълнено'}\nКомпания: ${fields.company?.value || 'Не е попълнено'}\nЛокация: ${fields.location?.value || 'Не е попълнено'}\nЗаплата: ${preview.salary.textContent}\n\nАкцент:\n${summary}\n\nОписание:\n${description.substring(0, 400)}${description.length > 400 ? '...' : ''}`;
        alert(`Бърз преглед на офертата:${previewMessage}`);
      });

      form.addEventListener('submit', () => {
        syncBenefits();
        renderRequirements();
      });
    })();
</script>
</body>
</html>


